<!doctype html>
<html>
  <head>
      <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
      <meta name="description" content="Tulip on the web. An affordable, portable and focused Python device for music, writing and coding">
      <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
      <meta property="og:title" content="Tulip Creative Computer Web">
      <meta property="og:image" content="https://tulip.computer/img/tulip_hero.jpg">
      <meta property="og:description" content="Tulip on the web. An affordable, portable and focused Python device for music, writing and coding">

      <meta name="twitter:card" content="summary_large_image">
      <meta name="twitter:site" content="@shorepinesound">
      <meta name="twitter:creator" content="@shorepinesound">
      <meta name="twitter:title" content="Tulip Creative Computer Web">
      <meta name="twitter:description" content="Tulip on the web. An affordable, portable and focused Python device for music, writing and coding.">
      <meta name="twitter:image" content="https://tulip.computer/img/tulip_hero.jpg">

      <meta property="og:type" content="product" />
      <meta property="og:url" content="https://tulip.computer"/>
      <meta property="og:site_name" content="Tulip Creative Computer"/>
      <meta property="product:price:amount" content="58.90"/>
      <meta property="product:price:currency" content="USD"/>
      <meta property="og:availability" content="instock" />
      <script src="./mini-coi.js" scope="./"></script>
      <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
      crossorigin="anonymous"
      ></script>
      <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
      <link rel="icon" type="image/png" sizes="96x96" href="/img/favicon.png">
      <meta name="author" content="shore pine sound systems">
      <meta name="HandheldFriendly" content="true">
      <link rel="stylesheet" href="amyrepl.css"/>
      <title>Tulip Creative Computer Web</title>

      <meta charset="UTF-8">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"> 
      <script src="https://cdn.jsdelivr.net/npm/webmidi@latest/dist/iife/webmidi.iife.js"></script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.min.css" /> 
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.3/codemirror.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script> 
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.3/mode/python/python.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <script src="micropython.mjs" type="module"></script>
      <!--<script type="text/javascript" src="enable-threads.js"></script>-->
      <script type="text/javascript" src="amy.js"></script>
      <script type="text/javascript" src="spss.js"></script>
  </head>

  <body>
    <script type="module">
      mp = await loadMicroPython({
        stdout:null, 
        linebuffer: false,
        pystack: 64 * 1024, 
        heapsize: 8 * 1024 * 1024
      });

      // Tell MP to start serving a REPL
      await mp.replInit();
      // Start up the Tulip stuff
      await start_tulip();
      var editorElement = document.getElementById('collapseEditor');
      create_editor(editorElement);
      // Load in the share code if given
      const queryString = window.location.search;
      const url_params = new URLSearchParams(queryString);
      var share = url_params.get('share');
      if(share != null) {
        var bsCollapse = new bootstrap.Collapse(editorElement, {
          toggle: true
        });
        document.getElementById('showhideeditor').style.display='none';
        try {
          var code = decodeURIComponent(await decompress(share));
          editor.setValue(code);
          setTimeout(function () { editor.save() }, 100)
        } catch (e) {
          console.log("Couldn't decode share");
        }
      }

    </script>






    <div class="container-lg my-2 px-2">
      <h1><A HREF="https://tulip.computer/">Tulip</A> Web</h1>
      <p>
        <button class="btn btn-sm btn-primary" type="button" id="showhideeditor" data-bs-toggle="collapse" data-bs-target="#collapseEditor" aria-expanded="true" aria-controls="collapseEditor" onclick="document.getElementById('showhideeditor').style.display='none';">
          Show editor
        </button>
      </p>
      <div class="editor mb-4 collapse" id="collapseEditor"></div>
      <!-- Fake textarea to capture keystrokes on mobile -->
      <textarea id="textinput" autocapitalize="off" rows="1"></textarea>
      
      <!-- Tulip's SDL canvas -->
      <canvas id="canvas" tabindex=0></canvas>

      <form name="tulip_settings">
        <div class="row align-items-start">
          <div class="col-4 align-self-start">
            MIDI input: 
            <select onchange="setup_midi_devices()" name="midi_input" class="form-select form-select-sm" aria-label=".form-select-sm example">
              <option selected>[Not available]</option>
            </select>
          </div>
          <div class="col-4 align-self-start">
            MIDI output: 
            <select onchange="setup_midi_devices()" name="midi_output" class="form-select form-select-sm" aria-label=".form-select-sm example">
              <option selected>[Not available]</option>
            </select>
          </div>
        </div>
      </form>
    </div>
    <hr/>
    <div class="container-sm my-4 px-2">
      <h2>Welcome to a very WIP version of <a href="https://tulip.computer/">Tulip</a> for the web.</h2>
      <p>
        Tulip is a creative computer with lots of music and graphics functionality. <A HREF="https://tulip.computer">You can buy a hardware Tulip for $59.</A> 
        This version of Tulip is a simulator, running all the same code. There are some small changes and things we haven't yet ported over to the web, see below.
      </p>
      <p>If you've never used Tulip before, please check out these getting started tips:</p>
      <ul>
        <li><A href="https://github.com/shorepine/tulipcc/blob/main/docs/getting_started.md">Getting Started on Tulip</A></li>
        <li><A href="https://github.com/shorepine/tulipcc/blob/main/docs/music.md">Make music tutorial</A></li>
        <li><A href="https://github.com/shorepine/tulipcc/blob/main/docs/tulip_api.md">Full Tulip API</A></li>
        <li><A href="https://github.com/orgs/shorepine/projects/1">Roadmap</A></li>
      </ul>
      <h3>Some notes on the web port:</h3>
      <ul>
        <li>MIDI works on almost all browsers <a href="https://webmidijs.org/docs/getting-started/">except for Safari</a></li>
        <li>Tulip World and requests / http / url_save etc do not yet work</li>
        <li>time.sleep does not yet work. It will return immediately.</li>
        <li>Mobile browsers do not show a keyboard yet</li>
        <li>Audio input is available on Tulip but not here, as the microphone privacy prompt is too annoying and you can't change input sources on the web yet. You can change the <code>amy.js</code> include to <code>amy-audioin.js</code> if you want it.</li>
      </ul>
    </div>
    <script language="javascript">        
      // On keypress or click anywhere, start audio
      document.body.addEventListener('click', start_audio, true); 
      document.body.addEventListener('keydown', start_audio, true); 
      //document.querySelectorAll('.editor').forEach(create_editor);
      // We have to force that a click on the canvas focuses it, so that SDL can receive keypresses.
      document.querySelector('#canvas').addEventListener('click', function() {
        document.querySelector("#canvas").focus();
      });



    </script>



  </body>
</html>


